%%--------------------------------------
% DRUG RESISTANCE REPORT
%%--------------------------------------

\documentclass{article}\usepackage[]{graphicx}\usepackage[]{color}
% maxwidth is the original width if it is less than linewidth
% otherwise use linewidth (to make sure the graphics do not exceed the margin)
\makeatletter
\def\maxwidth{ %
  \ifdim\Gin@nat@width>\linewidth
    \linewidth
  \else
    \Gin@nat@width
  \fi
}
\makeatother

\definecolor{fgcolor}{rgb}{0.345, 0.345, 0.345}
\newcommand{\hlnum}[1]{\textcolor[rgb]{0.686,0.059,0.569}{#1}}%
\newcommand{\hlstr}[1]{\textcolor[rgb]{0.192,0.494,0.8}{#1}}%
\newcommand{\hlcom}[1]{\textcolor[rgb]{0.678,0.584,0.686}{\textit{#1}}}%
\newcommand{\hlopt}[1]{\textcolor[rgb]{0,0,0}{#1}}%
\newcommand{\hlstd}[1]{\textcolor[rgb]{0.345,0.345,0.345}{#1}}%
\newcommand{\hlkwa}[1]{\textcolor[rgb]{0.161,0.373,0.58}{\textbf{#1}}}%
\newcommand{\hlkwb}[1]{\textcolor[rgb]{0.69,0.353,0.396}{#1}}%
\newcommand{\hlkwc}[1]{\textcolor[rgb]{0.333,0.667,0.333}{#1}}%
\newcommand{\hlkwd}[1]{\textcolor[rgb]{0.737,0.353,0.396}{\textbf{#1}}}%
\let\hlipl\hlkwb

\usepackage{framed}
\makeatletter
\newenvironment{kframe}{%
 \def\at@end@of@kframe{}%
 \ifinner\ifhmode%
  \def\at@end@of@kframe{\end{minipage}}%
  \begin{minipage}{\columnwidth}%
 \fi\fi%
 \def\FrameCommand##1{\hskip\@totalleftmargin \hskip-\fboxsep
 \colorbox{shadecolor}{##1}\hskip-\fboxsep
     % There is no \\@totalrightmargin, so:
     \hskip-\linewidth \hskip-\@totalleftmargin \hskip\columnwidth}%
 \MakeFramed {\advance\hsize-\width
   \@totalleftmargin\z@ \linewidth\hsize
   \@setminipage}}%
 {\par\unskip\endMakeFramed%
 \at@end@of@kframe}
\makeatother

\definecolor{shadecolor}{rgb}{.97, .97, .97}
\definecolor{messagecolor}{rgb}{0, 0, 0}
\definecolor{warningcolor}{rgb}{1, 0, 1}
\definecolor{errorcolor}{rgb}{1, 0, 0}
\newenvironment{knitrout}{}{} % an empty environment to be redefined in TeX

\usepackage{alltt}

% Install packages here

\usepackage[letterpaper]{geometry}

\usepackage{fancyhdr}
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage[table]{xcolor}
\usepackage{tabu}
\usepackage{collcell}
\usepackage{multirow}
\usepackage[skins]{tcolorbox}
\usepackage{fontspec}

%----- ESTABLISH COMMANDS HERE

% For column U, defined as right of left margin
\newcolumntype{U}{>{\collectcell\MakeUppercase}l<{\endcollectcell}}

\tcbuselibrary{listings,breakable}

%bounding box for report sections
\newtcolorbox{reportSection}[2][]{%
  attach boxed title to top left
  			   = {xshift=10pt, yshift=-8pt},
  colback      = white!5!white,
  colframe     = white!75!black,
  fonttitle    = \bfseries,
  colbacktitle = white,
  title        = \textbf{\large{#2}},
  coltitle	   = black,
  arc = 0mm,
  opacityframe = 0.5,
  boxrule=1pt,
  boxed title style={%
    sharp corners, 
    rounded corners=northwest, 
    colback=white, 
    boxrule=0pt,
    titlerule=0mm},
  enhanced,
}


%----- MAKE HEADER + FOOTER

%HEADER
%HEADER TEXT
\pagestyle{fancy}
\fancyhf{}
\renewcommand{\headrulewidth}{0pt}

% HEADER TEXT
\lhead{\Large{\textbf{MYCOBACTERIUM TUBERCULOSIS\\ RESISTANCE REPORT}} \\ \normalsize{UNDER DEVELOPMENT}}
\chead{}
\rhead{\includegraphics[scale=0.25]{data/LogoDesign}}

% FOOTER

\lfoot{Page \thepage\ of 2}
\rfoot{Patient ID:  | DATE: 19/05/2020 | LOCATION: LabPLUS }


% ------- Start of document
\IfFileExists{upquote.sty}{\usepackage{upquote}}{}
\begin{document}




\tabulinesep=5pt
\noindent 
\taburulecolor{lightgray}
\noindent \begin{tabu} to \textwidth {|XU||XU|}
\hline

% PATIENT TABLE

Patient Name & Douglas Jones & Barcode & \\ \hline DOB & 4 & NHI Number & 3 \\ \hline Location & 1 & Sample Type & 1 \\ \hline 

\end{tabu}
\vspace{5mm}
% SECTION 1

\begin{reportSection}{Summary}

\vspace{1mm}

\begin{kframe}


{\ttfamily\noindent\bfseries\color{errorcolor}{\#\# Error: <text>:10:33: unexpected '\{'\\\#\# 9:\ \  nItem<-nrow(tmp)\\\#\# 10:\ \  syntaxNice<-NULLif(nItem == 1)\{\\\#\#\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \  \textasciicircum{}}}\end{kframe}

\end{reportSection}
\vspace{5mm}

% Can do summary for detected lineage and organism here

% Drug Susceptibility Report
\begin{kframe}


{\ttfamily\noindent\bfseries\color{errorcolor}{\#\# Error: <text>:52:56: unexpected '\{'\\\#\# 51:\ \  for(i in 1:nrow(tickStatus))\{\\\#\# 52:\ \ \ \  status<-NULLif(tickStatus[i,]\$threshold == nResist)\{\\\#\#\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textasciicircum{}}}\end{kframe}

\begin{reportSection}{Drug Susceptibility}

\vspace{1mm}

\tabulinesep=2pt
\noindent
\taburulecolor{lightgray}
\noindent \begin{tabu} to \textwidth {X[1.1,l]X}

% Tick boxed
\multirow{4}{*}{\parbox{7.3cm}{\footnotesize{Resistance is reported when a high-confidence resistance-conferring mutation is detected. \textbf{``No mutation detected'' does not exclude the possibility of resistance}}}}

\begin{kframe}


{\ttfamily\noindent\bfseries\color{errorcolor}{\#\# Error in drugSusceptTickBox(drugDat): could not find function "{}drugSusceptTickBox"{}}}\end{kframe}
\end{tabu}
\vspace{3mm}

\tabulinesep=5pt
\noindent
\taburulecolor{lightgray}
\noindent \begin{tabu} to \textwidth {X[0.5,l]X[0.75,l]X[0.75,l]X[2,l]}
\hline
Drug class & Interpretation & Drug & Resistance Gene \scriptsize{(Amino Acid Mutation)} \\
\cline{1-4}
\begin{kframe}


{\ttfamily\noindent\bfseries\color{errorcolor}{\#\# Error in susceptData(drugDat, class = "{}First-line"{}): could not find function "{}susceptData"{}}}\end{kframe}
\cline{1-4}
\begin{kframe}


{\ttfamily\noindent\bfseries\color{errorcolor}{\#\# Error in susceptData(drugDat, class = "{}Second-line"{}): could not find function "{}susceptData"{}}}\end{kframe}
\end{tabu}
\end{reportSection}

% Additional comments

\begin{reportSection}{Assay Details}
\vspace{1mm}
\tabulinesep=5pt
\noindent
\taburulecolor{lightgray}
\noindent \begin{tabu} to \textwidth {|XU||XU|}
\hline
% BASED ON ISO15189 reporting standards

Sample ID & A12345    & Barcode   &     \\ \hline
Sequencer & Illumina HiSeq 2500   & Method    & WGS     \\ \hline
Pipeline  & Resistance v.0.1a   & Reference   & H37Rv     \\ \hline

\end{tabu}
\vspace{1mm}

\end{reportSection}
\vspace{1mm}

% Additional comments part 2

\begin{reportSection}{Comments}
\vspace{1mm}

\footnotesize{}
\vspace{2mm}

\textcolor{gray}{\footnotsize{\textit{\textbf{Standard Disclaimer:} Low frequency hetero-resistance below the limit of detection by sequencing may affect typing results.  The interpretation provided is based on the current understanding of genotype-phenotype relationships.}}}

\end{reportSection}
\vspace{1mm}

% Autherisation

\begin{reportSection}{Authorised}

\vspace{1mm}
\tabulinesep=5pt
\noindent
\taburulecolor{lightgray}
\noindent \begin{tabu} to \textwidth {|XU||XU|}
\hline

Signature & & Name  & \\ \hline
Position  & & Date  &   \\ \hline

\end{tabu}

\end{reportSection}

\end{document}
